$include "src/functions/s1.maple"
with(LinearAlgebra):
with(ArrayTools):

kernelopts(assertlevel=1);



# test 
#number_rows, s1_matrix, s1_lookup_table := calculate_s1(8):
s1_matrix, s1_lookup_table := calculate_s1(8):

# verification
#ASSERT(number_rows = 12, "calculate_s1(8): Failed number of rows test");

test_matrix := Matrix(84, 6,
[
[  1,   8,  64, 447, 447, 447],
[  2,  16, 128, 383, 383, 383],
[  3,  24, 192, 319, 319, 319],
[  4,  32, 256, 255, 255, 255],
[  5,  40, 320, 191, 191, 191],
[  6,  48, 384, 127, 127, 127],
[  7,  56, 448,  63,  63,  63],
[  9,  72,  65, 446, 446, 446],
[ 10,  80, 129, 382, 382, 382],
[ 11,  88, 193, 318, 318, 318],
[ 12,  96, 257, 254, 254, 254],
[ 13, 104, 321, 190, 190, 190],
[ 14, 112, 385, 126, 126, 126],
[ 15, 120, 449,  62,  62,  62],
[ 17, 136,  66, 445, 445, 445],
[ 18, 144, 130, 381, 381, 381],
[ 19, 152, 194, 317, 317, 317],
[ 20, 160, 258, 253, 253, 253],
[ 21, 168, 322, 189, 189, 189],
[ 22, 176, 386, 125, 125, 125],
[ 23, 184, 450,  61,  61,  61],
[ 25, 200,  67, 444, 444, 444],
[ 26, 208, 131, 380, 380, 380],
[ 27, 216, 195, 316, 316, 316],
[ 28, 224, 259, 252, 252, 252],
[ 29, 232, 323, 188, 188, 188],
[ 30, 240, 387, 124, 124, 124],
[ 31, 248, 451,  60,  60,  60],
[ 33, 264,  68, 443, 443, 443],
[ 34, 272, 132, 379, 379, 379],
[ 35, 280, 196, 315, 315, 315],
[ 36, 288, 260, 251, 251, 251],
[ 37, 296, 324, 187, 187, 187],
[ 38, 304, 388, 123, 123, 123],
[ 39, 312, 452,  59,  59,  59],
[ 41, 328,  69, 442, 442, 442],
[ 42, 336, 133, 378, 378, 378],
[ 43, 344, 197, 314, 314, 314],
[ 44, 352, 261, 250, 250, 250],
[ 45, 360, 325, 186, 186, 186],
[ 46, 368, 389, 122, 122, 122],
[ 47, 376, 453,  58,  58,  58],
[ 49, 392,  70, 441, 441, 441],
[ 50, 400, 134, 377, 377, 377],
[ 51, 408, 198, 313, 313, 313],
[ 52, 416, 262, 249, 249, 249],
[ 53, 424, 326, 185, 185, 185],
[ 54, 432, 390, 121, 121, 121],
[ 55, 440, 454,  57,  57,  57],
[ 73,  73,  73, 438, 438, 438],
[ 74,  81, 137, 374, 374, 374],
[ 75,  89, 201, 310, 310, 310],
[ 76,  97, 265, 246, 246, 246],
[ 77, 105, 329, 182, 182, 182],
[ 78, 113, 393, 118, 118, 118],
[ 82, 145, 138, 373, 373, 373],
[ 83, 153, 202, 309, 309, 309],
[ 84, 161, 266, 245, 245, 245],
[ 85, 169, 330, 181, 181, 181],
[ 86, 177, 394, 117, 117, 117],
[ 90, 209, 139, 372, 372, 372],
[ 91, 217, 203, 308, 308, 308],
[ 92, 225, 267, 244, 244, 244],
[ 93, 233, 331, 180, 180, 180],
[ 94, 241, 395, 116, 116, 116],
[ 98, 273, 140, 371, 371, 371],
[ 99, 281, 204, 307, 307, 307],
[100, 289, 268, 243, 243, 243],
[101, 297, 332, 179, 179, 179],
[102, 305, 396, 115, 115, 115],
[106, 337, 141, 370, 370, 370],
[107, 345, 205, 306, 306, 306],
[108, 353, 269, 242, 242, 242],
[109, 361, 333, 178, 178, 178],
[110, 369, 397, 114, 114, 114],
[146, 146, 146, 365, 365, 365],
[147, 154, 210, 301, 301, 301],
[148, 162, 274, 237, 237, 237],
[149, 170, 338, 173, 173, 173],
[155, 218, 211, 300, 300, 300],
[156, 226, 275, 236, 236, 236],
[157, 234, 339, 172, 172, 172],
[163, 282, 212, 299, 299, 299],
[164, 290, 276, 235, 235, 235]
]
):
ASSERT(Equal(s1_matrix, test_matrix), "calculate_s1(8): Failed matrix test");


test_lookup_table := Array(
[
1, 2, 3, 4, 5, 6, 7, 1, 9, 10, 11, 12, 13, 14, 15, 2, 17, 18, 19,
20, 21, 22, 23, 3, 25, 26, 27, 28, 29, 30, 31, 4, 33, 34, 35, 36,
37, 38, 39, 5, 41, 42, 43, 44, 45, 46, 47, 6, 49, 50, 51, 52, 53,
54, 55, 7, 55, 47, 39, 31, 23, 15, 7, 1, 9, 17, 25, 33, 41, 49, 0,
9, 73, 74, 75, 76, 77, 78, 0, 10, 74, 82, 83, 84, 85, 86, 0, 11,
75, 90, 91, 92, 93, 94, 0, 12, 76, 98, 99, 100, 101, 102, 0, 13,
77, 106, 107, 108, 109, 110, 0, 14, 78, 110, 102, 94, 86, 78, 0,
15, 54, 46, 38, 30, 22, 14, 6, 2, 10, 18, 26, 34, 42, 50, 0, 17,
74, 82, 90, 98, 106, 0, 0, 18, 82, 146, 147, 148, 149, 0, 0, 19,
83, 147, 155, 156, 157, 0, 0, 20, 84, 148, 163, 164, 0, 0, 0, 21,
85, 149, 0, 157, 149, 0, 0, 22, 86, 109, 101, 93, 85, 77, 0, 23, 53,
45, 37, 29, 21, 13, 5, 3, 11, 19, 27, 35, 43, 51, 0, 25, 75, 83, 91,
99, 107, 0, 0, 26, 90, 147, 155, 163, 0, 0, 0, 27, 91, 155, 0, 0,
0, 0, 0, 28, 92, 156, 0, 0, 0, 0, 0, 29, 93, 157, 164, 156, 148,
0, 0, 30, 94, 108, 100, 92, 84, 76, 0, 31, 52, 44, 36, 28, 20, 12,
4, 4, 12, 20, 28, 36, 44, 52, 0, 33, 76, 84, 92, 100, 108, 0, 0, 34,
98, 148, 156, 164, 0, 0, 0, 35, 99, 163, 0, 0, 0, 0, 0, 36, 100,
164, 0, 0, 0, 0, 0, 37, 101, 0, 163, 155, 147, 0, 0, 38, 102, 107,
99, 91, 83, 75, 0, 39, 51, 43, 35, 27, 19, 11, 3, 5, 13, 21, 29, 37,
45, 53, 0, 41, 77, 85, 93, 101, 109, 0, 0, 42, 106, 149, 157, 0, 0,
0, 0, 43, 107, 0, 0, 0, 0, 0, 0, 44, 108, 0, 0, 0, 0, 0, 0, 45, 109,
0, 0, 0, 146, 0, 0, 46, 110, 106, 98, 90, 82, 74, 0, 47, 50, 42, 34,
26, 18, 10, 2, 6, 14, 22, 30, 38, 46, 54, 0, 49, 78, 86, 94, 102,
110, 0, 0, 50, 0, 0, 0, 0, 0, 0, 0, 51, 0, 0, 0, 0, 0, 0, 0, 52,
0, 0, 0, 0, 0, 0, 0, 53, 0, 0, 0, 0, 0, 0, 0, 54, 0, 0, 0, 0, 0,
73, 0, 55, 49, 41, 33, 25, 17, 9, 1, 7, 15, 23, 31, 39, 47, 55,
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
]
):
ASSERT(IsEqual(s1_lookup_table, test_lookup_table), "calculate_s1(8): Failed lookup table test");
