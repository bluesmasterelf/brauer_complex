$include "src/functions/s2.maple"
with(LinearAlgebra):
with(ArrayTools):

kernelopts(assertlevel=1);



# test 
#number_rows, s2_matrix, s2_lookup_table := calculate_s2(8):
s2_matrix, s2_lookup_table := calculate_s2(8):

# verification
#ASSERT(number_rows = 12, "calculate_s2(8): Failed number of rows test");

test_matrix := Matrix(84, 6,
[
[  1,   8,  64, 449, 449, 449],
[  2,  16, 128, 385, 385, 385],
[  3,  24, 192, 321, 321, 321],
[  4,  32, 256, 257, 257, 257],
[  5,  40, 320, 193, 193, 193],
[  6,  48, 384, 129, 129, 129],
[  7,  56, 448,  65,  65,  65],
[  9,  72,  63, 450, 450, 450],
[ 10,  80, 127, 386, 386, 386],
[ 11,  88, 191, 322, 322, 322],
[ 12,  96, 255, 258, 258, 258],
[ 13, 104, 319, 194, 194, 194],
[ 14, 112, 383, 130, 130, 130],
[ 15, 120, 447,  66,  66,  66],
[ 17, 136,  62, 451, 451, 451],
[ 18, 144, 126, 387, 387, 387],
[ 19, 152, 190, 323, 323, 323],
[ 20, 160, 254, 259, 259, 259],
[ 21, 168, 318, 195, 195, 195],
[ 22, 176, 382, 131, 131, 131],
[ 23, 184, 446,  67,  67,  67],
[ 25, 200,  61, 452, 452, 452],
[ 26, 208, 125, 388, 388, 388],
[ 27, 216, 189, 324, 324, 324],
[ 28, 224, 253, 260, 260, 260],
[ 29, 232, 317, 196, 196, 196],
[ 30, 240, 381, 132, 132, 132],
[ 31, 248, 445,  68,  68,  68],
[ 33, 264,  60, 453, 453, 453],
[ 34, 272, 124, 389, 389, 389],
[ 35, 280, 188, 325, 325, 325],
[ 36, 288, 252, 261, 261, 261],
[ 37, 296, 316, 197, 197, 197],
[ 38, 304, 380, 133, 133, 133],
[ 39, 312, 444,  69,  69,  69],
[ 41, 328,  59, 454, 454, 454],
[ 42, 336, 123, 390, 390, 390],
[ 43, 344, 187, 326, 326, 326],
[ 44, 352, 251, 262, 262, 262],
[ 45, 360, 315, 198, 198, 198],
[ 46, 368, 379, 134, 134, 134],
[ 47, 376, 443,  70,  70,  70],
[ 49, 392,  58, 455, 455, 455],
[ 50, 400, 122, 391, 391, 391],
[ 51, 408, 186, 327, 327, 327],
[ 52, 416, 250, 263, 263, 263],
[ 53, 424, 314, 199, 199, 199],
[ 54, 432, 378, 135, 135, 135],
[ 55, 440, 442,  71,  71,  71],
[ 57, 456,  57, 456, 456, 456],
[ 74,  79, 119, 394, 394, 394],
[ 75,  87, 183, 330, 330, 330],
[ 76,  95, 247, 266, 266, 266],
[ 77, 103, 311, 202, 202, 202],
[ 78, 111, 375, 138, 138, 138],
[ 82, 143, 118, 395, 395, 395],
[ 83, 151, 182, 331, 331, 331],
[ 84, 159, 246, 267, 267, 267],
[ 85, 167, 310, 203, 203, 203],
[ 86, 175, 374, 139, 139, 139],
[ 90, 207, 117, 396, 396, 396],
[ 91, 215, 181, 332, 332, 332],
[ 92, 223, 245, 268, 268, 268],
[ 93, 231, 309, 204, 204, 204],
[ 94, 239, 373, 140, 140, 140],
[ 98, 271, 116, 397, 397, 397],
[ 99, 279, 180, 333, 333, 333],
[100, 287, 244, 269, 269, 269],
[101, 295, 308, 205, 205, 205],
[102, 303, 372, 141, 141, 141],
[106, 335, 115, 398, 398, 398],
[107, 343, 179, 334, 334, 334],
[108, 351, 243, 270, 270, 270],
[109, 359, 307, 206, 206, 206],
[110, 367, 371, 142, 142, 142],
[114, 399, 114, 399, 399, 399],
[147, 150, 174, 339, 339, 339],
[148, 158, 238, 275, 275, 275],
[149, 166, 302, 211, 211, 211],
[155, 214, 173, 340, 340, 340],
[156, 222, 237, 276, 276, 276],
[157, 230, 301, 212, 212, 212],
[163, 278, 172, 341, 341, 341],
[164, 286, 236, 277, 277, 277]
]
):
ASSERT(Equal(s2_matrix, test_matrix), "calculate_s2(8): Failed matrix test");


test_lookup_table := Array(
[
1, 2, 3, 4, 5, 6, 7, 1, 9, 10, 11, 12, 13, 14, 15, 2, 17, 18, 19, 20,
 21, 22, 23, 3, 25, 26, 27, 28, 29, 30, 31, 4, 33, 34, 35, 36, 37, 38,
 39, 5, 41, 42, 43, 44, 45, 46, 47, 6, 49, 50, 51, 52, 53, 54, 55, 7,
 57, 49, 41, 33, 25, 17, 9, 1, 7, 15, 23, 31, 39, 47, 55, 9, 0, 74, 75,
 76, 77, 78, 74, 10, 0, 82, 83, 84, 85, 86, 75, 11, 0, 90, 91, 92, 93,
 94, 76, 12, 0, 98, 99, 100, 101, 102, 77, 13, 0, 106, 107, 108, 109,
 110, 78, 14, 0, 114, 106, 98, 90, 82, 74, 15, 0, 50, 42, 34, 26, 18,
10, 2, 6, 14, 22, 30, 38, 46, 54, 17, 0, 78, 86, 94, 102, 110, 82, 18,
0, 0, 147, 148, 149, 147, 83, 19, 0, 0, 155, 156, 157, 148, 84, 20, 0,
0, 163, 164, 0, 149, 85, 21, 0, 0, 0, 163, 155, 147, 86, 22, 0, 0, 107,
99, 91, 83, 75, 23, 0, 51, 43, 35, 27, 19, 11, 3, 5, 13, 21, 29, 37, 45,
53, 25, 0, 77, 85, 93, 101, 109, 90, 26, 0, 0, 149, 157, 0, 155, 91, 27,
0, 0, 0, 0, 0, 156, 92, 28, 0, 0, 0, 0, 0, 157, 93, 29, 0, 0, 0, 164,
156, 148, 94, 30, 0, 0, 108, 100, 92, 84, 76, 31, 0, 52, 44, 36, 28, 20,
12, 4, 4, 12, 20, 28, 36, 44, 52, 33, 0, 76, 84, 92, 100, 108, 98, 34,
0, 0, 148, 156, 164, 163, 99, 35, 0, 0, 0, 0, 0, 164, 100, 36, 0, 0, 0,
0, 0, 0, 101, 37, 0, 0, 0, 0, 157, 149, 102, 38, 0, 0, 109, 101, 93, 85,
77, 39, 0, 53, 45, 37, 29, 21, 13, 5, 3, 11, 19, 27, 35, 43, 51, 41, 0,
75, 83, 91, 99, 107, 106, 42, 0, 0, 147, 155, 163, 0, 107, 43, 0, 0, 0,
0, 0, 0, 108, 44, 0, 0, 0, 0, 0, 0, 109, 45, 0, 0, 0, 0, 0, 0, 110, 46,
0, 0, 110, 102, 94, 86, 78, 47, 0, 54, 46, 38, 30, 22, 14, 6, 2, 10,
18, 26, 34, 42, 50, 49, 0, 74, 82, 90, 98, 106, 114, 50, 0, 0, 0, 0, 0,
0, 0, 51, 0, 0, 0, 0, 0, 0, 0, 52, 0, 0, 0, 0, 0, 0, 0, 53, 0, 0, 0, 0,
0, 0, 0, 54, 0, 0, 0, 0, 0, 0, 0, 55, 0, 55, 47, 39, 31, 23, 15, 7, 1,
9, 17, 25, 33, 41, 49, 57, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
]
):
ASSERT(IsEqual(s2_lookup_table, test_lookup_table), "calculate_s2(8): Failed lookup table test");
